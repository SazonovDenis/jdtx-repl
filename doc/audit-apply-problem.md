### Конфликт одновременного применения реплик и редактирования записи


#### Шаг 1

Добавляется запись Tab.id=1000, запись в состоянии "A".

Начинается репликация, запись отправляется в реплике на сервер в стоянии "A".


#### Шаг 2

Через некоторое время репликация повторяется, отправляются собственные измемения (которых пока нет),
забираются реплики с сервера (приходят собственные реплики).

Во время сеанса репликации пользователь начинает редактирование, в момент ПОСЛЕ отправки собственных измемений,
но ДО момента окончания репликации (и до применения собственных реплик с сервера). 
Запись Tab.id=1000 переходит в состояние "B".

Т.е. запись Tab.id=1000 отредактирована после обработки собственно аудита, но до применения своих реплик.

Продолжается репликация, во время применения собственных реплик запись Tab.id=1000 возвращается в стстояние "A".


#### Шаг 3

Через некоторое время репликация повторяется, станция обрабатывает свой аудит, 
отправляет собственные реплики, при этом запись Tab.id=1000, уходит на сервер в состоянии "A" 
(а пользователь последний раз вводил "B").


#### Решение

Возможно, нужен 
- либо полный аудит  
- либо учет возрастов записи (сравнение даты реплики и даты в таблице аудита)
  перед применением реплики.
- либо просто НИКОГДА не применяем реплику для той записи, 
  для которой существует нераспределенный (не отправленный на сервер) аудит. 
  Но тут нюанс - а что если таблица НЕ отправляется на сервер по условиям фильтрации? 
  Это не страшно, единственный момент, если запись отредактирована ДАВНО, а реплика свежая, 
  то желательно все-таки её применить.   
  
Сравнение возрастов легко, если реплика - моя. А что если реплика на ИЗМЕМЕНИЕ записи - чужая? 
Как гарантировать правильное сравнение возраста, если часы на филиалах не синхронны и различаются?
Еще сложность - в видимости записи в аудите для транзакции применения реплик.



### Заметки

Перед применением Чужой реплики делается Запрос к аудиту, на предмет наличия такой записи в собственном аудите,
сравнивается время реплики и собственного аудита, принимается решение о применении изменения от чужой реплики

Ранее при апдейте не требовался дополнительный селект, теперь требуется, я это работает только для режима
защищаемых таблиц

Это делать только при применении реплике апдейт, добавление и удаление записей проходят штатным образом

После применения собственной реплики аудит этого возраста можно удалять