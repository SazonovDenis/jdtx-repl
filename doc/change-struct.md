### Смена структуры

Есть три понятия:
- Утвержденная структура
- Зафиксированная структура
- Реальная структура

Утвержденная структура приходит с сервера как "разрешенная".
Зафиксированная структура запоминается в момент создания аудита.
Реальная структура - то что сейчас в БД.

#### Ожидание перехода на новую структуру

Если при старте репликатора когда реальная структура не совпадет 
с утвержденной - репликатор просто останавливается и ждет следующей попытки.

#### Переход на новую структуру

Если реальная структура не совпадет с утвержденной, то репликатор останавливатся.
Если реальная структура не совпадет с зафиксированной, то репликатор останавливатся.

Переход на новую структуру происходит (либо автоматически, при старте репликатора, либо по специальной команде `replication-init`), 
когда реальная отличается от зафиксированной, но совпадет с утвержденной. 
Тогда, по _разнице_ между зафиксированной структурой и разрешенной структурой досоздается аудит. 
При этом важно:
- Изменения в полях не имеют значения (потому что аудит запоминает только по id измененных записей)
- Если таблица появилась (т.е. это новая), то выгружается ее snapshot.
- Если таблица удалена, то удаляется и ее аудит. Данные, которые могли находится в аудите - отбрасываются, т.к. предполагается, 
  что данные из удаленной таблицы кто-то перенесет куда нужно при смене структуры, и это либо породит аудит (если перенос в существующую таблицу), 
  либо выгрузится snapshot-ом (если перенос в новую таблицу). Иными словами - если не жалко удалить таблицу, то ее аудит не жалко тем более. 

После досоздания аудита текущая структура БД запоминается как "зафиксированная" структура.


#### Переименование таблицы

На сервер будет выгружена порция данных, которые и так там есть. - 

    подумать - скорее всего норм, но ...

    ...если Abn переименовали в Abn1, то на сервере уже будет куча данных в Abn1, 
    а в таблице перекодлировок не будет данных о том, что это все чужие данные.  

#### Первичная инициализация рабочей станции

При инициализации репликации текущая реальная структура БД проссто копируется как "утвержденная", 
после чего инициализация snapshot и аудита происходит само собой, за счет механизма смены структуры.

Значт есть команды: 
- `replication-drop` (очистить все, весь аудит и все фиксированные структуры) 
- `replication-init` (посмотри, что там у тебя со структурой, устрани разницу).
