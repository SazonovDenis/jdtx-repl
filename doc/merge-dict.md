### Устранение дубликатов

Работа в распределенных базах благоприятствует возникновению дублирующихся записей,
чаще всего в справочниках. За ними нужно постоянно ухаживать.


##### Объединеие записей справочников от РАЗНЫХ рабочих станций.

Выполняется на сервере.
Выбираем несколько записей от РАЗНЫХ рабочих станций и назначаем им замену из ДРУГОЙ станции.
Заметно только на сервере, работает за счет правки значений в таблице перекодировок.

_p.s. Какая дикая мысль, сейчас кажется нелепостью. И почему два метода? Неудобно же. И как админу различать, когда какой юзать?_


##### Физическое объединеие записей

Готовится задание на слияние (на любой рабочей станции, в т.ч. центральной): 
в таблице-справочнике выбираем несколько записей, назначаем им замену из этой же таблицы. 
Получается команда "вот эти по списку - удали, вместо них - вот эта одна новая запись".

В задании на слияние "эталонная" запись должна быть именно ВСТАВЛЕНА как новая, а не выбранной из уже существующих, 
т.к. на рабочей станции может НЕ ОКАЗАТЬСЯ той записи, которую назначили как "эталонная" (из-за фильрации записей или по историческим причинам).

Далее можно:

1.
Выполнить это задание прямо на той же станции, произойдет реальный айпейт всех ссылок и реального удаления дублей записи,
и уже в виде потока обычных реплик поступает в общую очередь. Если выполнять на центральной базе, и в этой базе есть ВСЕ записи, 
то тогда можно действительно избавиться от ссылок на удаляемые записи.

Недостатки: слияние записей на центральной базе может породить большой объем КАСКАДНЫХ изменений, а пока они будут выполняться, 
помещаться в очередь и рассылаться по рабочим станциям, на самих рабочх станциях могут ДОПОЛНИТЕЛЬНО добавить записи, 
ссылающиеся на записи, на СЕРВЕРЕ уже удаленные. Это приведет либо к поломке приема "объединяющих реплик" с сервера, 
либо к массовому отказу в удалении и обратной вставке записей, удаленных на сервере. 

Сейчас реализовано в виде jdtx.repl.main.api.rec_merge.JdxRecMerger

2.
Реализация через отсылку команды для рабочей станции "объедини записи" (дополнительная к набору IDE/CUD) в очередь реплик.
Преимущества: малый объем реплик с сервера и полная безопасность в плане ссылочной целостности. 
Важно учесть, что на рабочей станции может НЕ ОКАЗАТЬСЯ той записи, которую назначили как "эталонная", 
поэтому ОБЯЗАТЕЛЬНОЙ частью команды "объедини записи" должна быть НОВАЯ эталонная запись, которая ЗАРАНЕЕ вставляется,
перед отправкой команды в очередь и вставляется ИГНОРИРУЯ правила фильрации.