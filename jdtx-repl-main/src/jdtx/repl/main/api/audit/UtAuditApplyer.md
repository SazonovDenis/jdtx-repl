### Взаимные зависимости в рамках одной реплики

Если пытаться выполнить реплики все сразу, то возможна ошибка применения реплик из-за ссылочной целостности.
Например, при слиянии дубликатов в справочнике CommentTip появятся реплики:

CommentTip:
 - вставить запись 5
 - удалить записи 1, 2, 3, 4

Comment:
 - заменить ссылку CommentTip с 1 на 5
 - заменить ссылку CommentTip с 2 на 5
 - заменить ссылку CommentTip с 3 на 5
 - удалить запись со ссылкой CommentTip равной 4

Этот поток реплик, хотя является в конечном итоге правильным, тем не менее,
не может быть обработан без ошибок из за ссылочной целостности, на шаге
CommentTip:
 - удалить записи 1, 2, 3, 4

возникнет ошибка.

Его нужно выполнять в такой последовательности (каковой она и была в реальности):

CommentTip:
 - вставить запись 5

Comment:
 - заменить ссылку CommentTip с 1 на 5
 - заменить ссылку CommentTip с 2 на 5
 - заменить ссылку CommentTip с 3 на 5
 - удалить запись со ссылкой CommentTip раной 4

CommentTip:
 - удалить записи 1, 2, 3, 4

Посколько исходная взаимная очередность вставки в основную и влияющую таблицы в реплике не содержится,
то проще отложить удаление на второй проход.


### Удаление + вставка или вставка + удаление в рамках одной реплики

При откладывании удаления на второй проход может встретиться ситуация, когда приходит такая реплика:
 - вставить запись 5
 - удалить запись 5

либо такая:
 - удалить запись 5
 - вставить запись 5

Во первом случае запись 5 была сначала вставлена, а потом удалена, и в итоге запись в базе ОТСУТСТВУЕТ.
Во втором случае запись 5 была вставлена давно, а потом отредактирован путем удаления старой 
и вставки новой записи, и в итоге запись в базе ЕСТЬ. 
В этом втором случае, если вторым проходом выполнить удаление записи 5, то база рассинхонизируется.

Выход в том, что во время накопления списка на удаление, при встрече реплики на вставку, 
запись из списка на удаление убирается (помним, что реплики на вставку для существующей записи 
вызовут их применение как реплики на обновление существующей записи).

Таким образом на второй проход удалений остаются только те удаления, которые были в потоке реплик ПОСЛЕДНИМИ 
и реально привели к окончательному удалению записи из базы. 
Подобное убеждение основано на том, что совпадение порядка записей в РЕПЛИКЕ 
с реальным порядком ИЗМЕНЕНИЙ (из таблицы аудита) - гарантируется.
